services:
  kidtube:
    image: ghcr.io/${GITHUB_REPOSITORY:-example/kidtube}:main
    container_name: kidtube
    environment:
      APP_NAME: ${APP_NAME:-KidTube}
      APP_VERSION: ${APP_VERSION:-0.1.0}
      PORT: 2018
      DATABASE_URL: ${DATABASE_URL:-sqlite:////data/kidtube.db}
      LOG_LEVEL: ${LOG_LEVEL:-INFO}
      DISCORD_PUBLIC_KEY: ${DISCORD_PUBLIC_KEY:-}
    volumes:
      - ./data:/data
    labels:
      - traefik.enable=true
      - traefik.http.routers.kidtube.rule=Host(`${KIDTUBE_HOST}`)
      - traefik.http.routers.kidtube.entrypoints=${TRAEFIK_ENTRYPOINT:-websecure}
      - traefik.http.routers.kidtube.tls=true
      - traefik.http.services.kidtube.loadbalancer.server.port=2018
    networks:
      - traefik
    restart: unless-stopped

networks:
  traefik:
    external: true
